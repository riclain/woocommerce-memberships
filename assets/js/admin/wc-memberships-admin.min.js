(function(){"use strict";jQuery(document).ready(function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return t=null!=(m=window.wc_memberships_admin)?m:{},s=null!=(n=window.typenow)?n:"",i=null!=(o=window.pagenow)?o:"",e=function(){var a;return a={formatMatches:function(a){return 1===a?wc_enhanced_select_params.i18n_matches_1:wc_enhanced_select_params.i18n_matches_n.replace("%qty%",a)},formatNoMatches:function(){return wc_enhanced_select_params.i18n_no_matches},formatAjaxError:function(a,b,c){return wc_enhanced_select_params.i18n_ajax_error},formatInputTooShort:function(a,b){var c;return c=b-a.length,1===c?wc_enhanced_select_params.i18n_input_too_short_1:wc_enhanced_select_params.i18n_input_too_short_n.replace("%qty%",c)},formatInputTooLong:function(a,b){var c;return c=a.length-b,1===c?wc_enhanced_select_params.i18n_input_too_long_1:wc_enhanced_select_params.i18n_input_too_long_n.replace("%qty%",c)},formatSelectionTooBig:function(a){return 1===a?wc_enhanced_select_params.i18n_selection_too_long_1:wc_enhanced_select_params.i18n_selection_too_long_n.replace("%qty%",a)},formatLoadMore:function(a){return wc_enhanced_select_params.i18n_load_more},formatSearching:function(){return wc_enhanced_select_params.i18n_searching}}},t.initializeEnhancedSelect=function(b,c){var d;return a(b).is(".enhanced")&&a(b).removeClass("enhanced"),d={allowClear:a(b).data("allow_clear")?!0:!1,placeholder:a(b).data("placeholder"),minimumInputLength:a(b).data("minimum_input_length")?a(b).data("minimum_input_length"):"3",escapeMarkup:function(a){return a},ajax:{url:t.ajax_url,dataType:"json",quietMillis:250,data:function(b,d){return a.extend({term:b},c)},results:function(b,c){var d;return d=[],b&&a.each(b,function(a,b){return d.push({id:a,text:b})}),{results:d}},cache:!0}},a(b).data("multiple")===!0?(d.multiple=!0,d.initSelection=function(b,c){var d,e;return d=a.parseJSON(b.attr("data-selected")),e=[],a(b.val().split(",")).each(function(a,b){return e.push({id:b,text:d[b]})}),c(e)},d.formatSelection=function(a){return'<div class="selected-option" data-id="'+a.id+'">'+a.text+"</div>"}):(d.multiple=!1,d.initSelection=function(a,b){var c;return c={id:a.val(),text:a.attr("data-selected")},b(c)}),d=a.extend(d,e()),a(b).select2(d).addClass("enhanced")},k=function(a){var b;return b={type:a.split("|")[0],name:a.split("|")[1]}},d=function(a){var b;switch(b={},a.type){case"taxonomy":b.action="wc_memberships_json_search_terms",b.security=t.search_terms_nonce,b.taxonomy=a.name;break;case"post_type":b.action="product"===a.name?"woocommerce_json_search_products_and_variations":"wc_memberships_json_search_posts",b.security="product"===a.name?t.search_products_nonce:t.search_posts_nonce,b.post_type=a.name}return b},l=function(b){var c;return c=0,a("table."+b+"-rules tbody."+b+"-rule").each(function(d,e){return a(e).hasClass(b+"-rule-__INDEX__")?void 0:(a(e).removeClass(function(a,c){var d,e;return e=new RegExp(b+"-rule-[0-9]","g"),d=c.match(e),d?d[0]:void 0}),a(e).addClass(b+"-rule-"+c),a("input, select, textarea",e).each(function(a,b){var d;return d=jQuery(b),d.attr("name")?d.attr("name",d.attr("name").replace(/\[([^[]*)\]/,"["+c+"]")):void 0}),c++)})},r=function(b){var c,d,e,f;if(e=a(b).get(0).tagName,f="INPUT"===e?a('input[type="radio"][name="'+a(b).attr("name")+'"]:checked').val():a(b).val(),c=a(b).closest(".rule"),"immediate"===f){if(c.find(".js-show-if-access-schedule-immediate").removeClass("hide"),c.find(".js-hide-if-access-schedule-immediate").addClass("hide"),"SELECT"===e)return c.find(".js-access-schedule-period-selector").val(f).first().focus()}else if(c.find(".js-show-if-access-schedule-immediate").addClass("hide"),c.find(".js-hide-if-access-schedule-immediate").removeClass("hide"),"SELECT"!==e||a(b).hasClass("access_schedule-period")||c.find(".access_schedule-period").find("option").removeAttr("selected"),d=c.find(".access_schedule-amount"),d.val()||d.val(1),a(b).hasClass("js-schedule-type"))return d.focus()},f=function(b){var c,e,f;return f="."+b+"-rules",e="input.js-object-ids",c=a(f),c.on("change",".js-content-type",function(b){var c,f;return f=d(k(a(this).val())),c=a(this).closest("tr").find(e),a(c).removeData("selected").val("").select2("destroy"),t.initializeEnhancedSelect(c,f)}),c.on("change",".js-access-schedule-period-selector",function(a){return r(this)}),c.find(e).each(function(){var c,e;if(!a(this).closest("tbody").hasClass(b+"-rule-__INDEX__"))return e=a(this).closest("tbody").find(".js-content-type").get(0).value,c=d(k(e)),t.initializeEnhancedSelect(this,c)}),c.find(".js-add-rule").click(function(){var f,g,h,i,j;return g=c.find("."+b+"-rule-__INDEX__"),i=c.children("tbody").length-1,f=a(g.prop("outerHTML").replace(/__INDEX__/g,i)),g.before(f),f.find(".js-content-type").length&&(h=f.find(".js-content-type").get(0).value,j=d(k(h)),t.initializeEnhancedSelect(f.find(e),j)),c.find(".norules").addClass("hide"),c.find("tfoot .js-remove-rules").removeClass("hide"),l(b)}),c.find(".js-remove-rules").click(function(){var d;return d=c.find('td.check-column input[type="checkbox"]:checked'),a.when(d.closest("tbody").fadeOut(400,function(){var b;return b=a(this),b.find(".js-rule-id").val()?b.addClass("hide").find(".js-rule-remove").val(1):setTimeout(function(){return b.remove()},1)})).then(function(){return c.find(".rule:visible").length<1&&(c.find(".norules").removeClass("hide"),c.find(".js-remove-rules").addClass("hide")),c.find('th.check-column input[type="checkbox"]').removeAttr("checked"),l(b)})})},p=function(b,c){var d,e,f,g,h;if(g=b,"add_member"===c)f=a('<form method="get" action="'+t.new_user_membership_url+'"> <input type="hidden" name="post_type" value="wc_user_membership" /> <h3 class="wc-memberships-select-user">'+t.i18n.select_user+"</h3> </form>");else{if("transfer_membership"!==c)return;f=a('<div> <input type="hidden" name="post_type" value="wc_user_membership" /> <h3 class="wc-memberships-select-user">'+t.i18n.select_user+"</h3> </div>")}return f.append('<p><input type="hidden" class="wc-customer-search" name="user" id="search_member_id" data-placeholder="'+t.i18n.search_for_user+'" data-allow_clear="true" /></p>'),d=a('<div class="wp-pointer-buttons" />'),e=a('<a class="close wc-memberships-search-member-pointer-close" href="#">'+t.i18n.cancel+"</a>"),h=a('<button class="button button-primary">'+t.i18n[c]+"</button>"),e.on("click.pointer",function(a){return a.preventDefault(),g.pointer("close")}),"transfer_membership"===c&&h.on("click",function(b){var c,d;return b.preventDefault,d=a("#search_member_id").val(),d?(c={action:"wc_memberships_transfer_user_membership",security:t.transfer_user_membership_nonce,prev_user:g.data("user-id"),new_user:d,membership:g.data("membership-id")},a.post(t.ajax_url,c,function(a){return console.log(a),location.reload()})):void 0}),f.find("#search_member_id").on("change",function(b){return a(this).val()?h.removeAttr("disabled"):h.attr("disabled","disabled")}),f.find("#search_member_id").val()?h.removeAttr("disabled"):h.attr("disabled","disabled"),d.append(e).append(h),f.append(d),f},q=function(b){return a(document.body).trigger("wc-enhanced-select-init")},"woocommerce_page_wc-settings"===i&&(a("#wc_memberships_restriction_mode").change(function(b){return"redirect"===a(this).val()?a("#wc_memberships_redirect_page_id").closest("tr").show():a("#wc_memberships_redirect_page_id").closest("tr").hide(),"hide"===a(this).val()?a("#wc_memberships_show_excerpts").closest("tr").hide():a("#wc_memberships_show_excerpts").closest("tr").show()}).change(),a("#wc_memberships_display_member_login_notice").change(function(b){return"never"===a(this).val()?a("#wc_memberships_member_login_message").closest("tr").hide():a("#wc_memberships_member_login_message").closest("tr").show()}).change()),("edit-wc_user_membership"===i||"wc_user_membership"===i)&&(a(".page-title-action, .add-new-h2").pointer({pointerClass:"create-membership-pointer",position:"top",content:function(b){return p(a(this),"add_member")},buttons:function(a){return""}}).on("click",function(b){return b.preventDefault(),a(this).pointer("toggle")}).on("pointeropened",function(a){return q("search_member_id")}),a(".transfer_user_membership").pointer({pointerClass:"transfer-membership-pointer",position:"top",content:function(b){return p(a(this),"transfer_membership")},buttons:function(a){return""}}).on("click",function(b){return b.preventDefault(),a(this).pointer("toggle")}).on("pointeropened",function(a){return q("search_member_id")}),a(".delete-membership").on("click",function(a){return confirm(t.i18n.delete_membership_confirm)}),a(".delete-membership-and-subscription").on("click",function(b){var c;return b.preventDefault(),confirm(t.i18n.delete_membership_confirm)?(c={action:"wc_memberships_delete_membership_and_subscription",security:t.delete_user_membership_subscription_nonce,user_membership_id:a(this).data("user-membership-id"),subscription_id:a(this).data("subscription-id")},a.post(t.ajax_url,c,function(a){return console.log(a),window.location.href=t.user_membership_url})):void 0})),"wc_user_membership"===i&&(c=a(".js-user-membership-date").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:t.calendar_image,buttonImageOnly:!0,onSelect:function(b){var d,e,f;return f=a(this).is("#_start_date")?"minDate":"maxDate",e=a(this).data("datepicker"),d=a.datepicker.parseDate(e.settings.dateFormat||a.datepicker._defaults.dateFormat,b,e.settings),c.not(this).datepicker("option",f,d)}}),h={opacity:.6},a("#wc-memberships-user-membership-data").on("click","a.js-calc-expiration",function(b){var c,d,e,f;return b.preventDefault(),d=a("#post_parent"),e=a("#_start_date"),c=a("#_end_date"),f={action:"wc_memberships_get_membership_expiration_date",security:t.get_membership_expiration_nonce,plan:d.val(),start_date:e.val()},a.post(t.ajax_url,f,function(a){return c.val(a.data.substring(0,10))})}),a("#wc-memberships-user-membership-notes").on("click","a.js-add-note",function(b){var c,d;return b.preventDefault(),(d=a("textarea#user-membership-note").val())?(a("#wc-memberships-user-membership-notes").block({message:null,overlayCSS:h}),c={action:"wc_memberships_add_user_membership_note",post_id:a("#post_ID").val(),note:d,notify:a("#note-notify").is(":checked"),security:t.add_user_membership_note_nonce},a.post(t.ajax_url,c,function(b){var c;return c=a(b),a("ul.wc-user-membership-notes").prepend(c.find("#notes").html()),a("ul.wc-user-membership-recent-activity").prepend(c.find("#recent-activity").html()),a("#wc-memberships-user-membership-notes").unblock(),a("textarea#user-membership-note").val(""),a("#note-notify").prop("checked",!1)})):void 0}).on("click","a.js-delete-note",function(b){var c,d;return b.preventDefault(),d=a(this).closest("li.note"),a(d).block({message:null,overlayCSS:h}),c={action:"wc_memberships_delete_user_membership_note",note_id:a(d).attr("rel"),security:t.delete_user_membership_note_nonce},a.post(t.ajax_url,c,function(b){return a(d).remove()})})),"wc_membership_plan"===i&&(a.each(["content-restriction","product-restriction","purchasing-discount"],function(a,b){return f(b)}),t.initializeEnhancedSelect(a(".js-ajax-select-products"),{action:"woocommerce_json_search_products_and_variations",security:t.search_products_nonce,screen:"wc_membership_plan"}),a(".plan-access-length-field").on("change",".js-access-length-period-selector",function(b){var c,d,e;return e=a(".js-access-length-period-selector:checked",".plan-access-length-field").val(),d=a(this).closest(".form-field"),"unlimited"===e?d.find(".js-hide-if-access-length-unlimited").addClass("hide"):(d.find(".js-hide-if-access-length-unlimited").removeClass("hide"),c=d.find(".access_length-amount"),c.val()||c.val(1),a(this).hasClass("js-access-length-type")?c.focus():void 0)}),a("ul.wc-tabs").show(),a("div.panel-wrap").each(function(){return a(this).find("div.panel:not(:first)").hide()}),a("ul.wc-tabs a").click(function(){var b,c;switch(c=a(this).attr("href"),b=a(this).closest("div.panel-wrap"),a("ul.wc-tabs li",b).removeClass("active"),a(this).parent().addClass("active"),a("div.panel",b).hide(),a(c).show(),a(".js-memberships-restrict-notice").hide(),c){case"#membership-plan-data-restrict-content":a(".js-memberships-restrict-content-notice").show();break;case"#membership-plan-data-restrict-products":a(".js-memberships-restrict-products-notice").show()}return!1}),a("ul.wc-tabs li:visible").eq(0).find("a").click()),s&&t.restrictable_post_types.indexOf(s)>-1&&(a.each(["content-restriction","product-restriction","purchasing-discount"],function(a,b){return f(b)}),a(".wc-memberships .js-toggle-rules").on("click",function(){return a(this).closest("p.form-field").next(".js-restrictions").toggleClass("hide")}),a(".wc-memberships .js-toggle-custom-message").on("click",function(){return a(this).closest("p.form-field").next(".js-custom-message-editor-container").toggleClass("hide")}),"product"===i)?(b=a(".js-membership-plan-ids"),j={action:"wc_memberships_json_search_posts",security:t.search_posts_nonce,post_type:"wc_membership_plan"},g="initializeEnhancedSelect",t[g](b,j),a(document.body).on("woocommerce-product-type-change",function(b,c){return g=-1!==c.indexOf("variable")?"removeClass":"addClass",a(".wc-memberships .variable-notice")[g]("hide"),g="grouped"===c?"removeClass":"addClass",a(".wc-memberships .grouped-notice")[g]("hide"),g="grouped"===c?"addClass":"removeClass",a(".wc-memberships .wc-memberships-data")[g]("hide")})):void 0})}).call(this);
